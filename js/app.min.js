"use strict";

document.addEventListener('DOMContentLoaded', function () {
  // function's
  function bodyFixScroll(status) {
    var scrollPosition = 0;
    var paddingOffset = window.innerWidth - document.body.offsetWidth + 'px';
    var elementsFixed = document.querySelectorAll('.fixed');
    if (status) {
      document.body.classList.add('scroll-disabled');
      scrollPosition = window.pageYOffset;
      document.body.style.overflow = 'hidden';
      document.body.style.position = 'fixed';
      if (document.body.style.top) {
        document.body.style.top = document.body.style.top;
      } else {
        document.body.style.top = '-' + scrollPosition + 'px';
      }
      document.body.style.width = '100%';
      document.body.style.paddingRight = paddingOffset;
      if (elementsFixed) {
        elementsFixed.forEach(function (item) {
          item.style.marginRight = paddingOffset;
        });
      }
    } else {
      document.body.classList.remove('scroll-disabled');
      scrollPosition = Math.abs(parseInt(document.querySelector('body').style.top.replace('px', '')));
      document.body.style.removeProperty('overflow');
      document.body.style.removeProperty('position');
      document.body.style.removeProperty('top');
      document.body.style.removeProperty('width');
      document.body.style.removeProperty('padding-right');
      if (elementsFixed) {
        elementsFixed.forEach(function (item) {
          item.style.removeProperty('margin-right');
        });
      }
      window.scrollTo({
        top: !isNaN(scrollPosition) ? scrollPosition : 0,
        behavior: 'instant'
      });
    }
  }
  function padSlides(sliderEl, minCount) {
    var wrapper = sliderEl.querySelector('.swiper-wrapper');
    var slides = Array.from(wrapper.children);
    var diff = minCount - slides.length;
    if (diff > 0) {
      for (var i = 0; i < diff; i++) {
        var clone = slides[i % slides.length].cloneNode(true);
        clone.classList.add('swiper-slide--clone');
        wrapper.append(clone);
      }
    }
  }
  function initPaddedSlider(sliderEl) {
    var minCount = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 3;
    padSlides(sliderEl, minCount);
    return new Swiper(sliderEl, {
      slidesPerView: 'auto',
      spaceBetween: 26,
      loop: true,
      loopedSlides: sliderEl.querySelectorAll('.swiper-slide').length,
      navigation: {
        nextEl: sliderEl.parentNode.querySelector('.swiper-button-next')
      }
    });
  }

  // checker
  var useItemChecker = function useItemChecker(els, onClickOutside) {
    var checkBodyClick = function checkBodyClick(e) {
      var currentEl = e.target;
      while (currentEl) {
        if (els.includes(currentEl)) break;
        currentEl = currentEl.parentNode;
      }
      if (!currentEl) {
        onClickOutside();
        removeBodyChecker();
      }
    };
    function setBodyChecker() {
      document.documentElement.addEventListener('click', checkBodyClick);
    }
    function removeBodyChecker() {
      document.documentElement.removeEventListener('click', checkBodyClick);
    }
    return {
      setBodyChecker: setBodyChecker,
      removeBodyChecker: removeBodyChecker
    };
  };

  // slides up/down/toggle
  var slideUpQna = function slideUpQna(target) {
    var duration = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 400;
    target.style.transitionProperty = 'height, margin, padding';
    target.style.transitionDuration = duration + 'ms';
    target.style.height = target.offsetHeight + 'px';
    target.offsetHeight;
    target.style.overflow = 'hidden';
    target.style.height = 0;
    target.style.paddingTop = 0;
    target.style.paddingBottom = 0;
    target.style.marginTop = 0;
    target.style.marginBottom = 0;
    if (target.previousElementSibling) {
      target.previousElementSibling.style.pointerEvents = 'none';
    }
    window.setTimeout(function () {
      target.style.display = 'none';
      target.style.removeProperty('height');
      target.style.removeProperty('padding-top');
      target.style.removeProperty('padding-bottom');
      target.style.removeProperty('margin-top');
      target.style.removeProperty('margin-bottom');
      target.style.removeProperty('overflow');
      target.style.removeProperty('transition-duration');
      target.style.removeProperty('transition-property');
      if (target.previousElementSibling) {
        target.previousElementSibling.style.pointerEvents = 'auto';
      }
    }, duration);
    target.parentNode.classList.remove('is--open');
  };
  var slideDownQna = function slideDownQna(target) {
    var duration = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 400;
    target.style.removeProperty('display');
    var display = window.getComputedStyle(target).display;
    if (display === 'none') display = 'block';
    target.style.display = display;
    var height = target.offsetHeight;
    target.style.overflow = 'hidden';
    target.style.height = 0;
    target.style.paddingTop = 0;
    target.style.paddingBottom = 0;
    target.style.marginTop = 0;
    target.style.marginBottom = 0;
    target.offsetHeight;
    target.style.transitionProperty = "height, margin, padding";
    target.style.transitionDuration = duration + 'ms';
    target.style.height = height + 'px';
    target.style.removeProperty('padding-top');
    target.style.removeProperty('padding-bottom');
    target.style.removeProperty('margin-top');
    target.style.removeProperty('margin-bottom');
    if (target.previousElementSibling) {
      target.previousElementSibling.style.pointerEvents = 'none';
    }
    window.setTimeout(function () {
      target.style.removeProperty('height');
      target.style.removeProperty('overflow');
      target.style.removeProperty('transition-duration');
      target.style.removeProperty('transition-property');
      if (target.previousElementSibling) {
        target.previousElementSibling.style.pointerEvents = 'auto';
      }
    }, duration);
    target.parentNode.classList.add('is--open');
  };

  // inputmask
  Inputmask().mask(document.querySelectorAll('input'));

  // textarea
  var allTexareas = document.querySelectorAll('textarea');
  if (allTexareas) {
    allTexareas.forEach(function (el) {
      el.style.height = el.setAttribute('style', 'height: ' + el.scrollHeight + 'px');
      el.classList.add('auto');
      el.addEventListener('input', function (e) {
        el.style.height = 'auto';
        el.style.height = el.scrollHeight + 'px';
      });
    });
  }

  // select
  (function () {
    var selectBoxes = document.querySelectorAll('.select-box');
    if (!selectBoxes.length) return;

    // Закрыть все селекты
    function closeAllSelects() {
      document.querySelectorAll('.select-box__container.is--active').forEach(function (c) {
        return c.classList.remove('is--active');
      });
    }

    // Обновление текста мультиселекта и видимости выбранных
    function updateMultiSelect(selectBox) {
      var valuesDisplay = selectBox.querySelector('.select-box__values');
      var selectedWrapper = selectBox.querySelector('.select-box__section--selected');
      if (!selectedWrapper) return;
      var wrap = selectedWrapper.querySelector('.select-box__wrap');
      var values = Array.from(wrap.querySelectorAll('.select-box__option')).map(function (opt) {
        var _opt$querySelector;
        return ((_opt$querySelector = opt.querySelector('.select-box__value')) === null || _opt$querySelector === void 0 ? void 0 : _opt$querySelector.textContent.trim()) || '';
      }).filter(function (v) {
        return v;
      });
      valuesDisplay.textContent = values.join(', ');
      selectedWrapper.style.display = values.length ? '' : 'none';
    }

    // Перестроить список выбранных в исходном порядке
    function rebuildSelectedSection(selectBox) {
      var selectedWrapper = selectBox.querySelector('.select-box__section--selected');
      if (!selectedWrapper) return;
      var wrap = selectedWrapper.querySelector('.select-box__wrap');
      wrap.innerHTML = '';
      selectBox.querySelectorAll('.select-box__option').forEach(function (option) {
        var input = option.querySelector('input');
        if (input && input.checked) {
          var clone = option.cloneNode(true);
          clone.setAttribute('data-id', input.id);
          clone.addEventListener('click', function (e) {
            e.stopPropagation();
            input.checked = false;
            rebuildSelectedSection(selectBox);
            updateMultiSelect(selectBox);
          });
          wrap.appendChild(clone);
        }
      });
    }
    selectBoxes.forEach(function (selectBox) {
      var isSingle = selectBox.classList.contains('select-box--single');
      var container = selectBox.querySelector('.select-box__container');
      var selectedEl = selectBox.querySelector('.select-box__selected');
      var valuesDisplay = selectedEl.querySelector('.select-box__values');

      // Открытие/закрытие селекта
      var itemChecker = useItemChecker([selectBox, selectedEl], closeAllSelects);
      selectedEl.addEventListener('click', function () {
        if (container.classList.toggle('is--active')) {
          itemChecker.setBodyChecker();
        }
      });

      // Обработка клика по опции
      selectBox.querySelectorAll('.select-box__option').forEach(function (option) {
        var _label$querySelector, _option$querySelector;
        var input = option.querySelector('input');
        var label = option.querySelector('.select-box__label');
        var title = ((_label$querySelector = label.querySelector('.select-box__title')) === null || _label$querySelector === void 0 ? void 0 : _label$querySelector.textContent.trim()) || ((_option$querySelector = option.querySelector('.select-box__value')) === null || _option$querySelector === void 0 ? void 0 : _option$querySelector.textContent.trim()) || label.textContent.trim();
        option.addEventListener('click', function (e) {
          e.preventDefault();
          if (isSingle) {
            selectBox.querySelectorAll('input').forEach(function (inp) {
              return inp.checked = false;
            });
            input.checked = true;
            valuesDisplay.textContent = title;
            closeAllSelects();
          } else {
            input.checked = !input.checked;
            rebuildSelectedSection(selectBox);
            updateMultiSelect(selectBox);
          }
        });
      });

      // Инициализация мультиселекта
      if (!isSingle) {
        rebuildSelectedSection(selectBox);
        updateMultiSelect(selectBox);
      }
    });
  })();

  // mobile menu
  var mobileMenu = document.getElementById('menu');
  var mobileMenuTrigger = document.getElementById('hamburger-toggle');
  var mobileMenuClose = document.getElementById('menu-close');
  if (mobileMenu && mobileMenuTrigger && mobileMenuClose) {
    mobileMenuTrigger.addEventListener('click', function (event) {
      event.preventDefault();
      if (mobileMenu.classList.contains('is--active')) {
        mobileMenu.classList.remove('is--active');
        bodyFixScroll(0);
      } else {
        mobileMenu.classList.add('is--active');
        bodyFixScroll(1);
      }
    });
    mobileMenuClose.addEventListener('click', function (event) {
      event.preventDefault();
      if (mobileMenu.classList.contains('is--active')) {
        mobileMenu.classList.remove('is--active');
        bodyFixScroll(0);
      }
    });
  }

  // dropdown catalog
  var dropdownCatalog = document.getElementById('dropdown-catalog');
  var dropdownCatalogTrigger = document.getElementById('dropdown-catalog-toggle');
  var dropdownCatalogClose = document.querySelectorAll('.dropdown-catalog__close');
  if (dropdownCatalog && dropdownCatalogTrigger && dropdownCatalogClose) {
    dropdownCatalogTrigger.addEventListener('click', function (event) {
      event.preventDefault();
      if (dropdownCatalog.classList.contains('is--active')) {
        dropdownCatalog.classList.remove('is--active');
        bodyFixScroll(0);
      } else {
        dropdownCatalog.classList.add('is--active');
        bodyFixScroll(1);
      }
    });
    dropdownCatalogClose.forEach(function (item) {
      item.addEventListener('click', function (event) {
        event.preventDefault();
        if (dropdownCatalog.classList.contains('is--active')) {
          dropdownCatalog.classList.remove('is--active');
          bodyFixScroll(0);
        }
      });
    });
  }

  // brands card accordeon
  var brandsCardTrigger = document.querySelectorAll('.brands-card__trigger');
  if (brandsCardTrigger) {
    brandsCardTrigger.forEach(function (item) {
      item.addEventListener('click', function (event) {
        event.preventDefault();
        if (!item.parentNode.classList.contains('is--open')) {
          slideDownQna(item.nextElementSibling);
        } else {
          slideUpQna(item.nextElementSibling);
        }
      });
    });
  }

  // catalog filter
  var catalogFilter = document.getElementById('catalog-filter');
  var catalogFilterTrigger = document.getElementById('catalog-filter-toggle');
  var catalogFilterClose = document.querySelectorAll('.catalog-filter__close');
  if (catalogFilter && catalogFilterTrigger && catalogFilterClose) {
    catalogFilterTrigger.addEventListener('click', function (event) {
      event.preventDefault();
      if (catalogFilter.classList.contains('is--active')) {
        catalogFilter.classList.remove('is--active');
        bodyFixScroll(0);
      } else {
        catalogFilter.classList.add('is--active');
        bodyFixScroll(1);
      }
    });
    catalogFilterClose.forEach(function (item) {
      item.addEventListener('click', function (event) {
        event.preventDefault();
        if (catalogFilter.classList.contains('is--active')) {
          catalogFilter.classList.remove('is--active');
          bodyFixScroll(0);
        }
      });
    });
  }

  // catalog filter
  var productMore = document.querySelector('.product__more');
  var productInfo = document.getElementById('product-info');
  var productInfoClose = document.querySelectorAll('.product-info__close');
  if (productMore && productInfo && productInfoClose) {
    productInfo.addEventListener('click', function (event) {
      if (event.target.classList.contains('product-info')) {
        event.preventDefault();
        productInfo.classList.remove('is--active');
        bodyFixScroll(0);
      }
    });
    productMore.addEventListener('click', function (event) {
      event.preventDefault();
      if (productInfo.classList.contains('is--active')) {
        productInfo.classList.remove('is--active');
        bodyFixScroll(0);
      } else {
        productInfo.classList.add('is--active');
        bodyFixScroll(1);
      }
    });
    productInfoClose.forEach(function (item) {
      item.addEventListener('click', function (event) {
        event.preventDefault();
        if (productInfo.classList.contains('is--active')) {
          productInfo.classList.remove('is--active');
          bodyFixScroll(0);
        }
      });
    });
  }

  // quantity
  var quantity = document.querySelectorAll('.c-quantity');
  if (quantity) {
    quantity.forEach(function (item) {
      var value = item.querySelector('.c-quantity__value');
      var btnMinus = item.querySelector('.c-quantity__btn--minus');
      var btnPlus = item.querySelector('.c-quantity__btn--plus');
      var currentValue = parseInt(value.dataset.value) || 0;
      if (currentValue <= 1) {
        item.classList.add('c-quantity--one');
      }
      btnMinus.addEventListener('click', function (event) {
        event.preventDefault();
        if (currentValue > 1) {
          currentValue--;
          value.dataset.value = currentValue;
          value.innerHTML = currentValue;
        }
        if (currentValue <= 1) {
          item.classList.add('c-quantity--one');
        }
      });
      btnPlus.addEventListener('click', function (event) {
        event.preventDefault();
        currentValue++;
        value.dataset.value = currentValue;
        value.innerHTML = currentValue;
        if (currentValue > 1) {
          item.classList.remove('c-quantity--one');
        }
      });
    });
  }

  // basket stage
  var basketWrap = document.querySelector('.basket');
  var basketOrderBtn = document.querySelector('.basket-total__btn--mobile');
  var basketOrderBack = document.querySelector('.basket__close--back');
  if (basketWrap && basketOrderBtn && basketOrderBack) {
    basketOrderBtn.addEventListener('click', function (event) {
      event.preventDefault();
      if (!basketWrap.classList.contains('basket--order')) {
        basketWrap.classList.add('basket--order');
      }
    });
    basketOrderBack.addEventListener('click', function (event) {
      event.preventDefault();
      if (basketWrap.classList.contains('basket--order')) {
        basketWrap.classList.remove('basket--order');
      }
    });
  }

  // modal
  var modal = document.querySelectorAll('.modal');
  var modalBtn = document.querySelectorAll('.modal-btn');
  var modalClose = document.querySelectorAll('.modal__close');
  if (modal && modalBtn && modalClose) {
    // modal
    modal.forEach(function (item) {
      item.addEventListener('click', function (event) {
        if (event.target.classList.contains('modal') || event.target.classList.contains('modal__wrap')) {
          event.preventDefault();
          document.querySelectorAll('.modal.is--active').forEach(function (child) {
            return child.classList.remove('is--active');
          });
          document.body.classList.remove('scroll-disabled');
        }
      });
    });

    // modal btn
    modalBtn.forEach(function (item, i) {
      item.addEventListener('click', function (event) {
        event.preventDefault();
        var modalID = item.dataset.id;
        document.querySelectorAll('.modal.is--active').forEach(function (child) {
          return child.classList.remove('is--active');
        });
        document.getElementById(modalID).classList.add('is--active');
        document.body.classList.add('scroll-disabled');
      });
    });

    // modal close
    modalClose.forEach(function (item) {
      item.addEventListener('click', function (event) {
        event.preventDefault();
        var parent = item.closest('.modal');
        var modalID = parent.id;
        document.querySelectorAll('.modal.is--active').forEach(function (child) {
          return child.classList.remove('is--active');
        });
        document.body.classList.remove('scroll-disabled');
      });
    });
  }

  // recommends slider
  var recommendsSliders = document.querySelectorAll('.recommends__slider');
  if (recommendsSliders) {
    recommendsSliders.forEach(function (slider) {
      var swiperSlider = slider.querySelector('.swiper');
      var nextZone = slider.querySelector('.swiper-zone-next');
      var nextBtn = slider.querySelector('.swiper-button-next');
      var swiper = initPaddedSlider(swiperSlider, 10);
      var showBtn = function showBtn(x, y) {
        gsap.killTweensOf(nextBtn);
        gsap.set(nextBtn, {
          x: x,
          y: y
        });
        nextBtn.style.pointerEvents = 'auto';
        gsap.to(nextBtn, {
          opacity: 1,
          duration: 0.3,
          ease: 'power3.out'
        });
      };
      var hideBtn = function hideBtn() {
        gsap.killTweensOf(nextBtn);
        gsap.to(nextBtn, {
          opacity: 0,
          duration: 0.2,
          ease: 'power3.out',
          onComplete: function onComplete() {
            return nextBtn.style.pointerEvents = 'none';
          }
        });
      };
      nextZone.addEventListener('click', function () {
        return swiper.slideNext();
      });
      nextZone.addEventListener('mousemove', function (e) {
        var rect = nextZone.getBoundingClientRect();
        var x = e.clientX - rect.left;
        var y = e.clientY - rect.top;
        showBtn(x, y);
      });
      nextZone.addEventListener('mouseleave', hideBtn);
    });
  }

  // product slider
  var productSlider = document.querySelector('.product__slider .swiper');
  if (productSlider) {
    var myProductSlider = new Swiper(productSlider, {
      slidesPerView: 'auto',
      breakpoints: {
        0: {
          spaceBetween: 6
        },
        744: {
          spaceBetween: 13
        }
      }
    });
  }

  // product slider
  var blogInnerSlider = document.querySelector('.blog-inner__slider .swiper');
  if (blogInnerSlider) {
    var myBlogInnerSlider = new Swiper(blogInnerSlider, {
      slidesPerView: 'auto',
      breakpoints: {
        0: {
          spaceBetween: 30
        },
        744: {
          spaceBetween: 51
        }
      }
    });
  }

  // promotion blog
  var promotionBlog = document.querySelector('.pro-blog');
  if (promotionBlog) {
    var cursorBtn = promotionBlog.querySelector('.pro-blog__read-more');
    var targetHref = cursorBtn.href;
    var interactiveSelector = 'a, button';
    promotionBlog.addEventListener('mousemove', function (e) {
      var rect = promotionBlog.getBoundingClientRect();
      var _cursorBtn$getBoundin = cursorBtn.getBoundingClientRect(),
        width = _cursorBtn$getBoundin.width,
        height = _cursorBtn$getBoundin.height;
      var x = e.clientX - rect.left;
      var y = e.clientY - rect.top;
      var left = x - width / 2;
      var top = y - height / 2;
      gsap.to(cursorBtn, {
        duration: 0.5,
        left: left,
        top: top,
        ease: "power3.out"
      });
      if (e.target.closest(interactiveSelector)) {
        cursorBtn.classList.remove('is--active');
      } else {
        cursorBtn.classList.add('is--active');
      }
    });
    promotionBlog.addEventListener('mouseleave', function () {
      cursorBtn.classList.remove('is--active');
    });
    promotionBlog.addEventListener('click', function (e) {
      if (e.target.closest('a, button')) return;
      window.location.href = targetHref;
    });
  }

  // scroll
  var prevScrollpos = window.pageYOffset;
  var product = document.querySelector('.product');
  var productLeft = document.querySelector('.product__left');
  var productRight = document.querySelector('.product__body');
  var coordOffsetBottom = 0; // Fixed block on bottom position
  var coordOffsetTop = 0; // Fixed block on offsetop position

  function getCoords(elem) {
    var box = elem.getBoundingClientRect();
    return {
      top: box.top + pageYOffset,
      left: box.left + pageXOffset
    };
  }
  function productScroll() {
    if (product && productLeft && productRight) {
      if (window.innerWidth >= 1024) {
        var currentScrollPos = window.pageYOffset;
        if (prevScrollpos > currentScrollPos || prevScrollpos <= 0) {
          // If up
          if (productRight.classList.contains('product__fixed--active')) {
            // Если при фиксированном блоке скроллим вверх - убираем фиксацию
            productRight.classList.remove('product__fixed--active');
            productRight.classList.add('product__fixed--bottom');
            productRight.style.position = 'relative';
            productRight.style.top = '0px';
            productRight.style.transform = 'translate3d(0px, ' + coordOffsetTop + 'px, 0px)';
          }
          if (window.pageYOffset <= getCoords(productRight).top && productRight.classList.contains('product__fixed--bottom')) {
            // Если проскроллили до верха блока - фиксируем
            productRight.classList.add('product__fixed--top');
            productRight.style.position = 'fixed';
            productRight.style.top = '0px';
            productRight.style.transform = 'translate3d(0px, 0px, 0px)';
          }
          if (window.pageYOffset <= product.offsetTop && productRight.classList.contains('product__fixed--top')) {
            productRight.classList.remove('product__fixed--top');
            productRight.style.position = 'relative';
            productRight.style.top = '0px';
            productRight.style.transform = 'translate3d(0px, 0px, 0px)';
          }
        } else {
          // If down
          coordOffsetTop = getCoords(productRight).top - product.offsetTop;
          if (productRight.classList.contains('product__fixed--top')) {
            productRight.classList.remove('product__fixed--top');
            productRight.style.position = 'relative';
            productRight.style.top = '0px';
            productRight.style.transform = 'translate3d(0px, ' + coordOffsetTop + 'px, 0px)';
          }
          if (window.pageYOffset >= getCoords(productRight).top + productRight.getBoundingClientRect().height - (document.documentElement.clientHeight - Number(30)) && !productRight.classList.contains('product__fixed--active')) {
            if (!(window.pageYOffset - product.offsetTop - Number(30) >= productLeft.getBoundingClientRect().height - document.documentElement.clientHeight)) {
              coordOffsetBottom = window.pageYOffset - product.offsetTop - productRight.getBoundingClientRect().height + window.innerHeight - 30;
            }
            productRight.classList.add('product__fixed--active');
            productRight.style.position = 'fixed';
            productRight.style.top = document.documentElement.clientHeight - Number(30) + 'px';
            productRight.style.transform = 'translate3d(0px, -100%, 0px)';
          }
          if (window.pageYOffset - product.offsetTop - Number(30) >= productLeft.getBoundingClientRect().height - document.documentElement.clientHeight) {
            var transformFixedBottom = product.getBoundingClientRect().height - productRight.getBoundingClientRect().height - Number(126);
            productRight.classList.remove('product__fixed--active');
            productRight.classList.add('product__fixed--bottom');
            productRight.style.position = 'relative';
            productRight.style.top = '0px';
            productRight.style.transform = 'translate3d(0px, ' + transformFixedBottom + 'px, 0px)';
          }
        }
        prevScrollpos = currentScrollPos;
      } else {
        productRight.style.position = 'relative';
        productRight.style.top = '0px';
        productRight.style.transform = 'translate3d(0px, 0px, 0px)';
      }
    }
  }
  window.addEventListener('scroll', function () {
    productScroll();
  });
});